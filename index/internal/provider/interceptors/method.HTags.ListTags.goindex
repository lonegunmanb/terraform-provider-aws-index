package github.com/hashicorp/terraform-provider-aws/internal/provider/interceptors
import (
	"context"
	"unique"

	"github.com/hashicorp/aws-sdk-go-base/v2/tfawserr"
	"github.com/hashicorp/terraform-plugin-framework/diag"
	"github.com/hashicorp/terraform-plugin-framework/path"
	"github.com/hashicorp/terraform-plugin-log/tflog"
	"github.com/hashicorp/terraform-provider-aws/internal/conns"
	"github.com/hashicorp/terraform-provider-aws/internal/errs"
	"github.com/hashicorp/terraform-provider-aws/internal/sdkv2"
	tftags "github.com/hashicorp/terraform-provider-aws/internal/tags"
	"github.com/hashicorp/terraform-provider-aws/internal/tfresource"
	inttypes "github.com/hashicorp/terraform-provider-aws/internal/types"
	tfunique "github.com/hashicorp/terraform-provider-aws/internal/unique"
	"github.com/hashicorp/terraform-provider-aws/names"
)
func (h HTags) ListTags(ctx context.Context, sp conns.ServicePackage, c taggingAWSClient, identifier string) error {
	var err error

	resourceType := h.value().ResourceType
	if v, ok := sp.(tftags.ServiceTagLister); ok {
		err = v.ListTags(ctx, c, identifier) // Sets tags in Context
	} else if v, ok := sp.(tftags.ResourceTypeTagLister); ok {
		if resourceType == "" {
			tflog.Error(ctx, "ListTags method requires ResourceType but none set", map[string]any{
				"ServicePackage": sp.ServicePackageName(),
			})
		} else {
			err = v.ListTags(ctx, c, identifier, resourceType) // Sets tags in Context
		}
	} else {
		tflog.Warn(ctx, "No ListTags method found", map[string]any{
			"ServicePackage": sp.ServicePackageName(),
			"ResourceType":   resourceType,
		})
	}

	switch {
	// ISO partitions may not support tagging, giving error.
	case errs.IsUnsupportedOperationInPartitionError(c.Partition(ctx), err):
		err = nil
	case sp.ServicePackageName() == names.DynamoDB && err != nil:
		// When a DynamoDB Table is `ARCHIVED`, ListTags returns `ResourceNotFoundException`.
		if tfresource.NotFound(err) || tfawserr.ErrMessageContains(err, "UnknownOperationException", "Tagging is not currently supported in DynamoDB Local.") {
			err = nil
		}
	}

	return err
}
