package github.com/hashicorp/terraform-provider-aws/internal/cty
import (
	"fmt"

	"github.com/hashicorp/go-cty/cty"
)
func PathSafeApply(p cty.Path, val cty.Value) (cty.Value, bool, error) {
	var err error

	if val.IsNull() {
		return cty.NilVal, false, nil
	}

	l := len(p)
	for i, step := range p {
		val, err = step.Apply(val)
		if err != nil {
			return cty.NilVal, false, fmt.Errorf("at step %d: %w", i, err)
		}
		if !HasValue(val) && i < l-1 {
			return cty.NilVal, false, nil
		}
	}
	return val, true, nil
}
