package github.com/hashicorp/terraform-provider-aws/internal/acctest/querycheck
import (
	"context"
	"fmt"
	"strings"

	tfjson "github.com/hashicorp/terraform-json"
	"github.com/hashicorp/terraform-plugin-testing/querycheck"
	"github.com/hashicorp/terraform-plugin-testing/querycheck/queryfilter"
)
func (e expectNoResourceObject) CheckQuery(_ context.Context, req querycheck.CheckQueryRequest, resp *querycheck.CheckQueryResponse) {
	var listRes []tfjson.ListResourceFoundData
	for _, res := range req.Query {
		if e.listResourceAddress == strings.TrimPrefix(res.Address, "list.") {
			listRes = append(listRes, res)
		}
	}

	if len(listRes) == 0 {
		resp.Error = fmt.Errorf("%s - no query results found after filtering", e.listResourceAddress)
		return
	}

	if len(listRes) > 1 {
		resp.Error = fmt.Errorf("%s - more than 1 query result found after filtering", e.listResourceAddress)
		return
	}

	res := listRes[0]

	if res.ResourceObject != nil {
		resp.Error = fmt.Errorf("%s - Expected no resource data, but was present!", e.listResourceAddress)
		return
	}
}
