package github.com/hashicorp/terraform-provider-aws/internal/service/logs
import (
	"context"
	"fmt"

	"github.com/YakDriver/regexache"
	"github.com/aws/aws-sdk-go-v2/aws"
	"github.com/aws/aws-sdk-go-v2/service/cloudwatchlogs"
	awstypes "github.com/aws/aws-sdk-go-v2/service/cloudwatchlogs/types"
	"github.com/hashicorp/terraform-plugin-framework-validators/listvalidator"
	"github.com/hashicorp/terraform-plugin-framework-validators/stringvalidator"
	"github.com/hashicorp/terraform-plugin-framework/resource"
	"github.com/hashicorp/terraform-plugin-framework/resource/schema"
	"github.com/hashicorp/terraform-plugin-framework/resource/schema/planmodifier"
	"github.com/hashicorp/terraform-plugin-framework/resource/schema/stringplanmodifier"
	"github.com/hashicorp/terraform-plugin-framework/schema/validator"
	"github.com/hashicorp/terraform-plugin-framework/types"
	"github.com/hashicorp/terraform-provider-aws/internal/errs"
	"github.com/hashicorp/terraform-provider-aws/internal/errs/fwdiag"
	"github.com/hashicorp/terraform-provider-aws/internal/framework"
	fwflex "github.com/hashicorp/terraform-provider-aws/internal/framework/flex"
	fwtypes "github.com/hashicorp/terraform-provider-aws/internal/framework/types"
	"github.com/hashicorp/terraform-provider-aws/internal/retry"
	"github.com/hashicorp/terraform-provider-aws/internal/tfresource"
	"github.com/hashicorp/terraform-provider-aws/names"
)
func (r *transformerResource) Schema(ctx context.Context, req resource.SchemaRequest, resp *resource.SchemaResponse) {
	resp.Schema = schema.Schema{
		Attributes: map[string]schema.Attribute{
			"log_group_arn": schema.StringAttribute{
				CustomType: fwtypes.ARNType,
				Required:   true,
				PlanModifiers: []planmodifier.String{
					stringplanmodifier.RequiresReplace(),
				},
			},
		},
		Blocks: map[string]schema.Block{
			"transformer_config": schema.ListNestedBlock{
				CustomType: fwtypes.NewListNestedObjectTypeOf[processorModel](ctx),
				Validators: []validator.List{
					listvalidator.IsRequired(),
					listvalidator.SizeBetween(1, 20),
				},
				NestedObject: schema.NestedBlockObject{
					Blocks: map[string]schema.Block{
						"add_keys": schema.ListNestedBlock{
							CustomType: fwtypes.NewListNestedObjectTypeOf[addKeysModel](ctx),
							Validators: []validator.List{
								listvalidator.SizeAtMost(1),
							},
							NestedObject: schema.NestedBlockObject{
								Blocks: map[string]schema.Block{
									"entry": schema.ListNestedBlock{
										CustomType: fwtypes.NewListNestedObjectTypeOf[addKeysEntryModel](ctx),
										Validators: []validator.List{
											listvalidator.IsRequired(),
											listvalidator.SizeBetween(1, 5),
										},
										NestedObject: schema.NestedBlockObject{
											Attributes: map[string]schema.Attribute{
												names.AttrKey: schema.StringAttribute{
													Required: true,
													Validators: []validator.String{
														stringvalidator.LengthBetween(1, 128),
													},
												},
												"overwrite_if_exists": schema.BoolAttribute{
													Optional: true,
													Computed: true,
												},
												names.AttrValue: schema.StringAttribute{
													Required: true,
													Validators: []validator.String{
														stringvalidator.LengthBetween(1, 256),
													},
												},
											},
										},
									},
								},
							},
						},
						"copy_value": schema.ListNestedBlock{
							CustomType: fwtypes.NewListNestedObjectTypeOf[copyValueModel](ctx),
							Validators: []validator.List{
								listvalidator.SizeAtMost(1),
							},
							NestedObject: schema.NestedBlockObject{
								Blocks: map[string]schema.Block{
									"entry": schema.ListNestedBlock{
										CustomType: fwtypes.NewListNestedObjectTypeOf[copyValueEntryModel](ctx),
										Validators: []validator.List{
											listvalidator.IsRequired(),
											listvalidator.SizeBetween(1, 5),
										},
										NestedObject: schema.NestedBlockObject{
											Attributes: map[string]schema.Attribute{
												"overwrite_if_exists": schema.BoolAttribute{
													Optional: true,
													Computed: true,
												},
												names.AttrSource: schema.StringAttribute{
													Required: true,
													Validators: []validator.String{
														stringvalidator.LengthBetween(1, 128),
													},
												},
												names.AttrTarget: schema.StringAttribute{
													Required: true,
													Validators: []validator.String{
														stringvalidator.LengthBetween(1, 128),
													},
												},
											},
										},
									},
								},
							},
						},
						"csv": schema.ListNestedBlock{
							CustomType: fwtypes.NewListNestedObjectTypeOf[csvModel](ctx),
							Validators: []validator.List{
								listvalidator.SizeAtMost(5),
							},
							NestedObject: schema.NestedBlockObject{
								Attributes: map[string]schema.Attribute{
									"columns": schema.ListAttribute{
										Optional:    true,
										Computed:    true,
										CustomType:  fwtypes.ListOfStringType,
										ElementType: types.StringType,
										Validators: []validator.List{
											listvalidator.SizeAtMost(100),
											listvalidator.ValueStringsAre(stringvalidator.LengthBetween(1, 128)),
										},
									},
									"delimiter": schema.StringAttribute{
										Optional: true,
										Computed: true,
										Validators: []validator.String{
											stringvalidator.LengthBetween(1, 2),
										},
									},
									"quote_character": schema.StringAttribute{
										Optional: true,
										Computed: true,
										Validators: []validator.String{
											stringvalidator.LengthBetween(1, 1),
										},
									},
									names.AttrSource: schema.StringAttribute{
										Optional: true,
										Computed: true,
										Validators: []validator.String{
											stringvalidator.LengthBetween(1, 128),
										},
									},
								},
							},
						},
						"date_time_converter": schema.ListNestedBlock{
							CustomType: fwtypes.NewListNestedObjectTypeOf[dateTimeConverterModel](ctx),
							Validators: []validator.List{
								listvalidator.SizeAtMost(20),
							},
							NestedObject: schema.NestedBlockObject{
								Attributes: map[string]schema.Attribute{
									"locale": schema.StringAttribute{
										Optional: true,
										Computed: true,
										Validators: []validator.String{
											stringvalidator.LengthAtLeast(1),
										},
									},
									"match_patterns": schema.ListAttribute{
										Required:    true,
										CustomType:  fwtypes.ListOfStringType,
										ElementType: types.StringType,
										Validators: []validator.List{
											listvalidator.SizeBetween(1, 5),
											listvalidator.ValueStringsAre(stringvalidator.LengthAtLeast(1)),
										},
									},
									names.AttrSource: schema.StringAttribute{
										Required: true,
										Validators: []validator.String{
											stringvalidator.LengthBetween(1, 128),
										},
									},
									"source_timezone": schema.StringAttribute{
										Optional: true,
										Computed: true,
										Validators: []validator.String{
											stringvalidator.LengthAtLeast(1),
										},
									},
									names.AttrTarget: schema.StringAttribute{
										Required: true,
										Validators: []validator.String{
											stringvalidator.LengthBetween(1, 128),
										},
									},
									"target_format": schema.StringAttribute{
										Optional: true,
										Computed: true,
										Validators: []validator.String{
											stringvalidator.LengthBetween(1, 64),
										},
									},
									"target_timezone": schema.StringAttribute{
										Optional: true,
										Computed: true,
										Validators: []validator.String{
											stringvalidator.LengthAtLeast(1),
										},
									},
								},
							},
						},
						"delete_keys": schema.ListNestedBlock{
							CustomType: fwtypes.NewListNestedObjectTypeOf[deleteKeysModel](ctx),
							Validators: []validator.List{
								listvalidator.SizeAtMost(20),
							},
							NestedObject: schema.NestedBlockObject{
								Attributes: map[string]schema.Attribute{
									"with_keys": schema.ListAttribute{
										Required:    true,
										CustomType:  fwtypes.ListOfStringType,
										ElementType: types.StringType,
										Validators: []validator.List{
											listvalidator.SizeBetween(1, 5),
											listvalidator.ValueStringsAre(stringvalidator.LengthAtLeast(1)),
										},
									},
								},
							},
						},
						"grok": schema.ListNestedBlock{
							CustomType: fwtypes.NewListNestedObjectTypeOf[grokModel](ctx),
							Validators: []validator.List{
								listvalidator.SizeAtMost(1),
							},
							NestedObject: schema.NestedBlockObject{
								Attributes: map[string]schema.Attribute{
									"match": schema.StringAttribute{
										Required: true,
										Validators: []validator.String{
											stringvalidator.LengthBetween(1, 512),
										},
									},
									names.AttrSource: schema.StringAttribute{
										Optional: true,
										Computed: true,
										Validators: []validator.String{
											stringvalidator.LengthBetween(1, 128),
										},
									},
								},
							},
						},
						"list_to_map": schema.ListNestedBlock{
							CustomType: fwtypes.NewListNestedObjectTypeOf[listToMapModel](ctx),
							Validators: []validator.List{
								listvalidator.SizeAtMost(20),
							},
							NestedObject: schema.NestedBlockObject{
								Attributes: map[string]schema.Attribute{
									"flatten": schema.BoolAttribute{
										Optional: true,
										Computed: true,
									},
									"flattened_element": schema.StringAttribute{
										CustomType: fwtypes.StringEnumType[awstypes.FlattenedElement](),
										Optional:   true,
										Computed:   true,
									},
									names.AttrKey: schema.StringAttribute{
										Required: true,
										Validators: []validator.String{
											stringvalidator.LengthBetween(1, 128),
										},
									},
									names.AttrSource: schema.StringAttribute{
										Required: true,
										Validators: []validator.String{
											stringvalidator.LengthBetween(1, 128),
										},
									},
									names.AttrTarget: schema.StringAttribute{
										Optional: true,
										Computed: true,
										Validators: []validator.String{
											stringvalidator.LengthBetween(1, 128),
										},
									},
									"value_key": schema.StringAttribute{
										Optional: true,
										Computed: true,
										Validators: []validator.String{
											stringvalidator.LengthBetween(1, 128),
										},
									},
								},
							},
						},
						"lower_case_string": schema.ListNestedBlock{
							CustomType: fwtypes.NewListNestedObjectTypeOf[lowerCaseStringModel](ctx),
							Validators: []validator.List{
								listvalidator.SizeAtMost(20),
							},
							NestedObject: schema.NestedBlockObject{
								Attributes: map[string]schema.Attribute{
									"with_keys": schema.ListAttribute{
										Required:    true,
										CustomType:  fwtypes.ListOfStringType,
										ElementType: types.StringType,
										Validators: []validator.List{
											listvalidator.SizeBetween(1, 10),
											listvalidator.ValueStringsAre(stringvalidator.LengthAtLeast(1)),
										},
									},
								},
							},
						},
						"move_keys": schema.ListNestedBlock{
							CustomType: fwtypes.NewListNestedObjectTypeOf[moveKeysModel](ctx),
							Validators: []validator.List{
								listvalidator.SizeAtMost(20),
							},
							NestedObject: schema.NestedBlockObject{
								Blocks: map[string]schema.Block{
									"entry": schema.ListNestedBlock{
										CustomType: fwtypes.NewListNestedObjectTypeOf[moveKeysEntryModel](ctx),
										Validators: []validator.List{
											listvalidator.IsRequired(),
											listvalidator.SizeBetween(1, 5),
										},
										NestedObject: schema.NestedBlockObject{
											Attributes: map[string]schema.Attribute{
												"overwrite_if_exists": schema.BoolAttribute{
													Optional: true,
													Computed: true,
												},
												names.AttrSource: schema.StringAttribute{
													Required: true,
													Validators: []validator.String{
														stringvalidator.LengthBetween(1, 128),
													},
												},
												names.AttrTarget: schema.StringAttribute{
													Required: true,
													Validators: []validator.String{
														stringvalidator.LengthBetween(1, 128),
													},
												},
											},
										},
									},
								},
							},
						},
						"parse_cloudfront": schema.ListNestedBlock{
							CustomType: fwtypes.NewListNestedObjectTypeOf[parseCloudfrontModel](ctx),
							Validators: []validator.List{
								listvalidator.SizeAtMost(1),
							},
							NestedObject: schema.NestedBlockObject{
								Attributes: map[string]schema.Attribute{
									names.AttrSource: schema.StringAttribute{
										Optional: true,
										Computed: true,
										Validators: []validator.String{
											stringvalidator.RegexMatches(regexache.MustCompile(`^@message$`), "must be '@message'"),
										},
									},
								},
							},
						},
						"parse_json": schema.ListNestedBlock{
							CustomType: fwtypes.NewListNestedObjectTypeOf[parseJSONModel](ctx),
							Validators: []validator.List{
								listvalidator.SizeAtMost(5),
							},
							NestedObject: schema.NestedBlockObject{
								Attributes: map[string]schema.Attribute{
									names.AttrDestination: schema.StringAttribute{
										Optional: true,
										Computed: true,
										Validators: []validator.String{
											stringvalidator.LengthBetween(1, 128),
										},
									},
									names.AttrSource: schema.StringAttribute{
										Optional: true,
										Computed: true,
										Validators: []validator.String{
											stringvalidator.LengthBetween(1, 128),
										},
									},
								},
							},
						},
						"parse_key_value": schema.ListNestedBlock{
							CustomType: fwtypes.NewListNestedObjectTypeOf[parseKeyValueModel](ctx),
							Validators: []validator.List{
								listvalidator.SizeAtMost(5),
							},
							NestedObject: schema.NestedBlockObject{
								Attributes: map[string]schema.Attribute{
									names.AttrDestination: schema.StringAttribute{
										Optional: true,
										Computed: true,
										Validators: []validator.String{
											stringvalidator.LengthBetween(1, 128),
										},
									},
									"field_delimiter": schema.StringAttribute{
										Optional: true,
										Computed: true,
										Validators: []validator.String{
											stringvalidator.LengthBetween(1, 128),
										},
									},
									"key_prefix": schema.StringAttribute{
										Optional: true,
										Computed: true,
										Validators: []validator.String{
											stringvalidator.LengthBetween(1, 128),
										},
									},
									"key_value_delimiter": schema.StringAttribute{
										Optional: true,
										Computed: true,
										Validators: []validator.String{
											stringvalidator.LengthBetween(1, 128),
										},
									},
									"non_match_value": schema.StringAttribute{
										Optional: true,
										Computed: true,
										Validators: []validator.String{
											stringvalidator.LengthBetween(1, 128),
										},
									},
									"overwrite_if_exists": schema.BoolAttribute{
										Optional: true,
										Computed: true,
									},
									names.AttrSource: schema.StringAttribute{
										Optional: true,
										Computed: true,
										Validators: []validator.String{
											stringvalidator.LengthBetween(1, 128),
										},
									},
								},
							},
						},
						"parse_postgres": schema.ListNestedBlock{
							CustomType: fwtypes.NewListNestedObjectTypeOf[parsePostgresModel](ctx),
							Validators: []validator.List{
								listvalidator.SizeAtMost(1),
							},
							NestedObject: schema.NestedBlockObject{
								Attributes: map[string]schema.Attribute{
									names.AttrSource: schema.StringAttribute{
										Optional: true,
										Computed: true,
										Validators: []validator.String{
											stringvalidator.RegexMatches(regexache.MustCompile(`^@message$`), "must be '@message'"),
										},
									},
								},
							},
						},
						"parse_route53": schema.ListNestedBlock{
							CustomType: fwtypes.NewListNestedObjectTypeOf[parseRoute53Model](ctx),
							Validators: []validator.List{
								listvalidator.SizeAtMost(1),
							},
							NestedObject: schema.NestedBlockObject{
								Attributes: map[string]schema.Attribute{
									names.AttrSource: schema.StringAttribute{
										Optional: true,
										Computed: true,
										Validators: []validator.String{
											stringvalidator.RegexMatches(regexache.MustCompile(`^@message$`), "must be '@message'"),
										},
									},
								},
							},
						},
						"parse_to_ocsf": schema.ListNestedBlock{
							CustomType: fwtypes.NewListNestedObjectTypeOf[parseToOCSFModel](ctx),
							Validators: []validator.List{
								listvalidator.SizeAtMost(1),
							},
							NestedObject: schema.NestedBlockObject{
								Attributes: map[string]schema.Attribute{
									"event_source": schema.StringAttribute{
										CustomType: fwtypes.StringEnumType[awstypes.EventSource](),
										Required:   true,
									},
									"ocsf_version": schema.StringAttribute{
										CustomType: fwtypes.StringEnumType[awstypes.OCSFVersion](),
										Required:   true,
									},
									names.AttrSource: schema.StringAttribute{
										Optional: true,
										Computed: true,
										Validators: []validator.String{
											stringvalidator.RegexMatches(regexache.MustCompile(`^@message$`), "must be '@message'"),
										},
									},
								},
							},
						},
						"parse_vpc": schema.ListNestedBlock{
							CustomType: fwtypes.NewListNestedObjectTypeOf[parseVPCModel](ctx),
							Validators: []validator.List{
								listvalidator.SizeAtMost(1),
							},
							NestedObject: schema.NestedBlockObject{
								Attributes: map[string]schema.Attribute{
									names.AttrSource: schema.StringAttribute{
										Optional: true,
										Computed: true,
										Validators: []validator.String{
											stringvalidator.RegexMatches(regexache.MustCompile(`^@message$`), "must be '@message'"),
										},
									},
								},
							},
						},
						"parse_waf": schema.ListNestedBlock{
							CustomType: fwtypes.NewListNestedObjectTypeOf[parseWAFModel](ctx),
							Validators: []validator.List{
								listvalidator.SizeAtMost(1),
							},
							NestedObject: schema.NestedBlockObject{
								Attributes: map[string]schema.Attribute{
									names.AttrSource: schema.StringAttribute{
										Optional: true,
										Computed: true,
										Validators: []validator.String{
											stringvalidator.RegexMatches(regexache.MustCompile(`^@message$`), "must be '@message'"),
										},
									},
								},
							},
						},
						"rename_keys": schema.ListNestedBlock{
							CustomType: fwtypes.NewListNestedObjectTypeOf[renameKeysModel](ctx),
							Validators: []validator.List{
								listvalidator.SizeAtMost(20),
							},
							NestedObject: schema.NestedBlockObject{
								Blocks: map[string]schema.Block{
									"entry": schema.ListNestedBlock{
										CustomType: fwtypes.NewListNestedObjectTypeOf[renameKeysEntryModel](ctx),
										Validators: []validator.List{
											listvalidator.IsRequired(),
											listvalidator.SizeBetween(1, 5),
										},
										NestedObject: schema.NestedBlockObject{
											Attributes: map[string]schema.Attribute{
												names.AttrKey: schema.StringAttribute{
													Required: true,
													Validators: []validator.String{
														stringvalidator.LengthBetween(1, 128),
													},
												},
												"overwrite_if_exists": schema.BoolAttribute{
													Optional: true,
													Computed: true,
												},
												"rename_to": schema.StringAttribute{
													Required: true,
													Validators: []validator.String{
														stringvalidator.LengthBetween(1, 128),
													},
												},
											},
										},
									},
								},
							},
						},
						"split_string": schema.ListNestedBlock{
							CustomType: fwtypes.NewListNestedObjectTypeOf[splitStringModel](ctx),
							Validators: []validator.List{
								listvalidator.SizeAtMost(20),
							},
							NestedObject: schema.NestedBlockObject{
								Blocks: map[string]schema.Block{
									"entry": schema.ListNestedBlock{
										CustomType: fwtypes.NewListNestedObjectTypeOf[splitStringEntryModel](ctx),
										Validators: []validator.List{
											listvalidator.IsRequired(),
											listvalidator.SizeBetween(1, 10),
										},
										NestedObject: schema.NestedBlockObject{
											Attributes: map[string]schema.Attribute{
												"delimiter": schema.StringAttribute{
													Required: true,
													Validators: []validator.String{
														stringvalidator.LengthBetween(1, 128),
													},
												},
												names.AttrSource: schema.StringAttribute{
													Required: true,
													Validators: []validator.String{
														stringvalidator.LengthBetween(1, 128),
													},
												},
											},
										},
									},
								},
							},
						},
						"substitute_string": schema.ListNestedBlock{
							CustomType: fwtypes.NewListNestedObjectTypeOf[substituteStringModel](ctx),
							Validators: []validator.List{
								listvalidator.SizeAtMost(20),
							},
							NestedObject: schema.NestedBlockObject{
								Blocks: map[string]schema.Block{
									"entry": schema.ListNestedBlock{
										CustomType: fwtypes.NewListNestedObjectTypeOf[substituteStringEntryModel](ctx),
										Validators: []validator.List{
											listvalidator.IsRequired(),
											listvalidator.SizeBetween(1, 10),
										},
										NestedObject: schema.NestedBlockObject{
											Attributes: map[string]schema.Attribute{
												"from": schema.StringAttribute{
													Required: true,
													Validators: []validator.String{
														stringvalidator.LengthBetween(1, 128),
													},
												},
												names.AttrSource: schema.StringAttribute{
													Required: true,
													Validators: []validator.String{
														stringvalidator.LengthBetween(1, 128),
													},
												},
												"to": schema.StringAttribute{
													Required: true,
													Validators: []validator.String{
														stringvalidator.LengthBetween(1, 128),
													},
												},
											},
										},
									},
								},
							},
						},
						"trim_string": schema.ListNestedBlock{
							CustomType: fwtypes.NewListNestedObjectTypeOf[trimStringModel](ctx),
							Validators: []validator.List{
								listvalidator.SizeAtMost(20),
							},
							NestedObject: schema.NestedBlockObject{
								Attributes: map[string]schema.Attribute{
									"with_keys": schema.ListAttribute{
										Required:    true,
										CustomType:  fwtypes.ListOfStringType,
										ElementType: types.StringType,
										Validators: []validator.List{
											listvalidator.SizeBetween(1, 10),
											listvalidator.ValueStringsAre(stringvalidator.LengthAtLeast(1)),
										},
									},
								},
							},
						},
						"type_converter": schema.ListNestedBlock{
							CustomType: fwtypes.NewListNestedObjectTypeOf[typeConverterModel](ctx),
							Validators: []validator.List{
								listvalidator.SizeAtMost(20),
							},
							NestedObject: schema.NestedBlockObject{
								Blocks: map[string]schema.Block{
									"entry": schema.ListNestedBlock{
										CustomType: fwtypes.NewListNestedObjectTypeOf[typeConverterEntryModel](ctx),
										Validators: []validator.List{
											listvalidator.IsRequired(),
											listvalidator.SizeBetween(1, 5),
										},
										NestedObject: schema.NestedBlockObject{
											Attributes: map[string]schema.Attribute{
												names.AttrKey: schema.StringAttribute{
													Required: true,
													Validators: []validator.String{
														stringvalidator.LengthBetween(1, 128),
													},
												},
												names.AttrType: schema.StringAttribute{
													CustomType: fwtypes.StringEnumType[awstypes.Type](),
													Required:   true,
												},
											},
										},
									},
								},
							},
						},
						"upper_case_string": schema.ListNestedBlock{
							CustomType: fwtypes.NewListNestedObjectTypeOf[upperCaseStringModel](ctx),
							Validators: []validator.List{
								listvalidator.SizeAtMost(20),
							},
							NestedObject: schema.NestedBlockObject{
								Attributes: map[string]schema.Attribute{
									"with_keys": schema.ListAttribute{
										Required:    true,
										CustomType:  fwtypes.ListOfStringType,
										ElementType: types.StringType,
										Validators: []validator.List{
											listvalidator.SizeBetween(1, 10),
											listvalidator.ValueStringsAre(stringvalidator.LengthAtLeast(1)),
										},
									},
								},
							},
						},
					},
				},
			},
		},
	}
}
