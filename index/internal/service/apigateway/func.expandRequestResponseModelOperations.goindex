package github.com/hashicorp/terraform-provider-aws/internal/service/apigateway
import (
	"fmt"
	"strconv"
	"strings"

	"github.com/aws/aws-sdk-go-v2/aws"
	"github.com/aws/aws-sdk-go-v2/service/apigateway/types"
	"github.com/hashicorp/terraform-plugin-sdk/v2/helper/schema"
)
func expandRequestResponseModelOperations(d *schema.ResourceData, key string, prefix string) []types.PatchOperation {
	operations := make([]types.PatchOperation, 0)

	oldModels, newModels := d.GetChange(key)
	oldModelMap := oldModels.(map[string]any)
	newModelMap := newModels.(map[string]any)

	for k := range oldModelMap {
		operation := types.PatchOperation{
			Op:   types.OpRemove,
			Path: aws.String(fmt.Sprintf("/%s/%s", prefix, strings.Replace(k, "/", "~1", -1))),
		}

		for nK, nV := range newModelMap {
			if nK == k {
				operation.Op = types.OpReplace
				operation.Value = aws.String(nV.(string))
			}
		}

		operations = append(operations, operation)
	}

	for nK, nV := range newModelMap {
		exists := false
		for k := range oldModelMap {
			if k == nK {
				exists = true
			}
		}
		if !exists {
			operation := types.PatchOperation{
				Op:    types.OpAdd,
				Path:  aws.String(fmt.Sprintf("/%s/%s", prefix, strings.Replace(nK, "/", "~1", -1))),
				Value: aws.String(nV.(string)),
			}
			operations = append(operations, operation)
		}
	}

	return operations
}
