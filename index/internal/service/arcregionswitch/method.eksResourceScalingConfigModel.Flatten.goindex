package github.com/hashicorp/terraform-provider-aws/internal/service/arcregionswitch
import (
	"cmp"
	"context"
	"errors"
	"slices"
	"time"

	"github.com/YakDriver/smarterr"
	"github.com/aws/aws-sdk-go-v2/aws"
	"github.com/aws/aws-sdk-go-v2/service/arcregionswitch"
	awstypes "github.com/aws/aws-sdk-go-v2/service/arcregionswitch/types"
	"github.com/hashicorp/terraform-plugin-framework-timeouts/resource/timeouts"
	"github.com/hashicorp/terraform-plugin-framework-validators/listvalidator"
	fwdiag "github.com/hashicorp/terraform-plugin-framework/diag"
	"github.com/hashicorp/terraform-plugin-framework/resource"
	fwschema "github.com/hashicorp/terraform-plugin-framework/resource/schema"
	"github.com/hashicorp/terraform-plugin-framework/resource/schema/listplanmodifier"
	"github.com/hashicorp/terraform-plugin-framework/resource/schema/planmodifier"
	"github.com/hashicorp/terraform-plugin-framework/resource/schema/stringplanmodifier"
	"github.com/hashicorp/terraform-plugin-framework/schema/validator"
	"github.com/hashicorp/terraform-plugin-framework/types"
	"github.com/hashicorp/terraform-provider-aws/internal/errs"
	"github.com/hashicorp/terraform-provider-aws/internal/framework"
	"github.com/hashicorp/terraform-provider-aws/internal/framework/flex"
	fwtypes "github.com/hashicorp/terraform-provider-aws/internal/framework/types"
	fwvalidators "github.com/hashicorp/terraform-provider-aws/internal/framework/validators"
	"github.com/hashicorp/terraform-provider-aws/internal/retry"
	"github.com/hashicorp/terraform-provider-aws/internal/smerr"
	tftags "github.com/hashicorp/terraform-provider-aws/internal/tags"
	"github.com/hashicorp/terraform-provider-aws/internal/tfresource"
	"github.com/hashicorp/terraform-provider-aws/names"
)
func (m *eksResourceScalingConfigModel) Flatten(ctx context.Context, v any) fwdiag.Diagnostics {
	var diags fwdiag.Diagnostics

	config, ok := v.(awstypes.EksResourceScalingConfiguration)
	if !ok {
		diags.AddError("Unexpected Type", "Expected awstypes.EksResourceScalingConfiguration")
		return diags
	}

	diags.Append(flex.Flatten(ctx, config.CapacityMonitoringApproach, &m.CapacityMonitoringApproach)...)
	diags.Append(flex.Flatten(ctx, config.EksClusters, &m.EKSClusters)...)
	diags.Append(flex.Flatten(ctx, config.KubernetesResourceType, &m.KubernetesResourceType)...)
	diags.Append(flex.Flatten(ctx, config.TargetPercent, &m.TargetPercent)...)
	diags.Append(flex.Flatten(ctx, config.TimeoutMinutes, &m.TimeoutMinutes)...)
	diags.Append(flex.Flatten(ctx, config.Ungraceful, &m.Ungraceful)...)
	if diags.HasError() {
		return diags
	}

	if len(config.ScalingResources) > 0 {
		scalingResources := make([]scalingResourcesModel, len(config.ScalingResources))
		for i, sr := range config.ScalingResources {
			for namespace, resourceMap := range sr {
				scalingResources[i].Namespace = types.StringValue(namespace)

				resources := make([]kubernetesScalingResourceModel, 0, len(resourceMap))
				for resourceName, resource := range resourceMap {
					var resourceModel kubernetesScalingResourceModel
					resourceModel.ResourceName = types.StringValue(resourceName)
					diags.Append(flex.Flatten(ctx, resource.Name, &resourceModel.Name)...)
					diags.Append(flex.Flatten(ctx, resource.Namespace, &resourceModel.Namespace)...)
					diags.Append(flex.Flatten(ctx, resource.HpaName, &resourceModel.HpaName)...)
					resources = append(resources, resourceModel)
				}

				var d fwdiag.Diagnostics
				scalingResources[i].Resources, d = fwtypes.NewSetNestedObjectValueOfValueSlice(ctx, resources)
				diags.Append(d...)
			}
		}

		var d fwdiag.Diagnostics
		m.ScalingResources, d = fwtypes.NewListNestedObjectValueOfValueSlice(ctx, scalingResources)
		diags.Append(d...)
	}

	return diags
}
